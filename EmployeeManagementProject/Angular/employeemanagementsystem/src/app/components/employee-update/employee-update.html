<div class="employee-update container mt-4">
  <div class="row">
    <div class="col-md-4">
      <div class="card p-3 shadow-sm search-card">
        <h5>Find Employee</h5>
        <p class="text-muted small">Enter name or email ID</p>
        <div class="input-group mb-2">
          <input #q type="text" class="form-control" placeholder="Name or email" (keyup.enter)="search(q.value)">
          <button type="button" class="btn btn-primary" (click)="search(q.value)">Search</button>
        </div>
        <div *ngIf="notFound" class="alert alert-warning mt-2 mb-2">No Employee found with this email id or name</div>
        <button type="button" class="btn btn-sm btn-info w-100" (click)="viewAllEmployees()">View All Employees</button>
        <div *ngIf="allEmployees.length" class="mt-2 small">
          <p class="mb-1"><b>Available Employees:</b></p>
          <div class="bg-light p-2 rounded" style="max-height: 150px; overflow-y: auto;">
            <div *ngFor="let emp of allEmployees" class="text-muted">
              {{ emp.id }} - {{ emp.name }} ({{ emp.email }})
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div *ngIf="employee && !isEditing; else editForm">
        <div class="card shadow-lg">
          <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <span>Employee Details</span>
            <button type="button" class="btn btn-sm btn-warning" (click)="toggleEdit()">Edit</button>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-sm-6"><b>Name:</b> {{ employee.name }}</div>
              <div class="col-sm-6"><b>Gender:</b> {{ employee.gender }}</div>
            </div>
            <div class="row mt-2">
              <div class="col-sm-6"><b>Email:</b> {{ employee.email }}</div>
              <div class="col-sm-6"><b>Date Of Join:</b> {{ employee.dateOfJoin | date:'mediumDate' }}</div>
            </div>
            <div class="row mt-2">
              <div class="col-sm-6"><b>Department:</b> {{ employee.department }}</div>
              <div class="col-sm-6"><b>Basic Salary:</b> {{ employee.salary || employee.basicSalary }}</div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #editForm>
        <div class="card shadow-lg" *ngIf="employee">
          <div class="card-header bg-dark text-white">Edit Employee Details</div>
          <div class="card-body">
            <form [formGroup]="updateForm">
              <div class="mb-3">
                <label class="form-label"><b>Name</b></label>
                <input type="text" class="form-control" formControlName="name">
                <small class="text-danger" *ngIf="updateForm.get('name')?.hasError('minlength') || updateForm.get('name')?.hasError('maxlength')">
                  Name must be between 5 and 25 characters
                </small>
              </div>

              <div class="mb-3">
                <label class="form-label"><b>Gender</b></label>
                <div>
                  <div class="form-check form-check-inline">
                    <input type="radio" class="form-check-input" value="MALE" name="gender" formControlName="gender">
                    <label class="form-check-label">MALE</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input type="radio" class="form-check-input" value="FEMALE" name="gender" formControlName="gender">
                    <label class="form-check-label">FEMALE</label>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label"><b>Email</b></label>
                <input type="email" class="form-control" formControlName="email">
                <small class="text-danger" *ngIf="updateForm.get('email')?.hasError('pattern')">
                  Only wipro.co.in email allowed
                </small>
              </div>

              <div class="mb-3">
                <label class="form-label"><b>Date Of Join</b></label>
                <input type="date" class="form-control" formControlName="dateOfJoin">
              </div>

              <div class="mb-3">
                <label class="form-label"><b>Basic Salary</b></label>
                <input type="number" class="form-control" formControlName="basicSalary">
                <small class="text-danger" *ngIf="updateForm.get('basicSalary')?.hasError('min') || updateForm.get('basicSalary')?.hasError('max')">
                  Salary must be between 5000 and 5000000
                </small>
              </div>

              <div class="mb-3">
                <label class="form-label"><b>Department</b></label>
                <select class="form-control" formControlName="department">
                  <option>IT</option>
                  <option>SALES</option>
                  <option>FINANCE</option>
                  <option>CYBER</option>
                  <option>HR</option>
                </select>
              </div>

              <div *ngIf="updateMessage" class="alert" [ngClass]="updateMessage.includes('success') ? 'alert-success' : 'alert-danger'">
                {{ updateMessage }}
              </div>

              <div class="d-flex gap-2">
                <button type="button" class="btn btn-success" (click)="save()" [disabled]="isSaving">
                  {{ isSaving ? 'Saving...' : 'Save' }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="isSaving">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </ng-template>

      <div *ngIf="!employee && !notFound" class="card text-center p-4">
        <div class="card-body text-muted">Enter name or email on the left to find and update employee details.</div>
      </div>
    </div>
  </div>
</div>
